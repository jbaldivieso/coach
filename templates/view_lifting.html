{% extends "base.html" %} {% block title %}Lifting Sessions - Coach{% endblock%}
{% block extra_css %}
<style>
  .block header {
    border-bottom: 1px solid lightgray;
    padding-bottom: 0.25em;
  }
  h3 {
    font-size: 125%;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  h3 .notes {
    font-size: 1rem;
  }
  h4 {
    font-weight: bold;
  }
  .exercise-detail:not(:last-child) {
    margin-bottom: 0.5em;
  }
  .exercise-detail span {
    display: inline-block;
  }
  .exercise-detail span:not(:last-child) {
    margin-right: 1em;
  }
  .notes {
    color: slategray;
  }
  .exercise-detail .notes {
    border-left: 4px solid lightgray;
    padding-left: 0.5em;
  }
  @media (min-width: 500px) {
    .exercise-detail {
      display: flex;
    }
    .exercise-detail h4 {
      flex: 1;
    }
    .stats {
      flex: 2;
    }
    .exercise-detail .notes {
      flex: 1;
      border: none;
      padding-left: 0;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="level is-mobile">
  <div class="level-left">
    <div class="level-item">
      <h1 class="title">Lifting Sessions</h1>
    </div>
  </div>
  <div class="level-right">
    <div class="level-item">
      <a href="{{ url_for('log_lifting') }}" class="button is-primary">
        <span class="icon"><i class="fas fa-plus"></i></span>
      </a>
    </div>
  </div>
</div>

<!-- Exercise Search -->
<div class="box">
  <div class="field">
    <div class="control has-icons-left">
      <input
        class="input"
        type="text"
        id="exercise-search"
        placeholder="Search exercises (e.g., 'squat', 'bench')..."
      />
      <span class="icon is-left">
        <i class="fas fa-search"></i>
      </span>
    </div>
    <p class="help">Search your exercise history</p>
  </div>

  <!-- Search Results -->
  <div id="search-results" style="display: none; margin-top: 1rem">
    <strong>Search Results:</strong>
    <div id="search-results-content" style="margin-top: 0.5rem"></div>
  </div>
</div>

{% if sessions %} {% for session in sessions %}
<div class="block">
  <header>
    <h3>
      <div>
        <span class="date">{{ session['date'] }}</span>
        <strong>{{ session['name'] }}</strong>
      </div>
      <a
        href="{{ url_for('edit_lifting', session_id=session['id']) }}"
        class="button is-warning"
      >
        <span class="icon"><i class="fas fa-edit"></i></span>
      </a>
    </h3>
    {% if session.notes %}
    <div class="notes">{{ session.notes }}</div>
    {% endif %}
  </header>
  {% for exercise in session.exercises %}
  <div class="exercise-detail">
    <h4>{{ exercise.exercise_name }}</h4>
    <div class="stats">
      {% if exercise.weight %}
      <span>{{ "%d" % exercise.weight }}lbs</span>
      {% endif %}
      <span>Sets: {{ exercise.reps_display }}</span>
      <span>Rest: {{ exercise.rest_seconds }} secs</span>
    </div>

    <div class="notes">{{ exercise.notes }}</div>
  </div>
  {% endfor %}
</div>
{% endfor %} {% else %}
<div class="notification is-info is-light">
  <p>No lifting sessions logged yet.</p>
  <a href="{{ url_for('log_lifting') }}" class="button is-primary mt-3">
    <span class="icon"><i class="fas fa-plus"></i></span>
    <span>Log Your First Session</span>
  </a>
</div>
{% endif %} {% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("exercise-search");
    const searchResults = document.getElementById("search-results");
    const searchResultsContent = document.getElementById(
      "search-results-content",
    );

    // Exercise search functionality
    let searchTimeout;
    searchInput.addEventListener("input", (e) => {
      const query = e.target.value.trim();

      // Clear previous timeout
      clearTimeout(searchTimeout);

      if (query.length < 2) {
        searchResults.style.display = "none";
        return;
      }

      // Debounce search by 300ms
      searchTimeout = setTimeout(() => {
        performSearch(query);
      }, 300);
    });

    function performSearch(query) {
      fetch(`/api/search-exercises?q=${encodeURIComponent(query)}`)
        .then((response) => response.json())
        .then((data) => {
          displaySearchResults(data.exercises);
        })
        .catch((error) => {
          console.error("Search error:", error);
          searchResults.style.display = "none";
        });
    }

    function displaySearchResults(exercises) {
      if (exercises.length === 0) {
        searchResultsContent.innerHTML =
          '<p class="has-text-grey-light">No matching exercises found.</p>';
        searchResults.style.display = "block";
        return;
      }

      let html = "";

      exercises.forEach((exercise) => {
        html += '<div class="exercise-detail">';
        html += `<h4>${formatDate(exercise.session_date)} - ${exercise.exercise_name}</h4>`;
        html += '<div class="stats">';

        if (exercise.weight) {
          html += `<span>${Math.round(exercise.weight)}lbs</span>`;
        } else {
          html += "<span>Bodyweight</span>";
        }

        html += `<span>Sets: ${exercise.reps_display}</span>`;

        if (exercise.rest_seconds) {
          html += `<span>Rest: ${exercise.rest_seconds} secs</span>`;
        }

        html += "</div>";

        if (exercise.notes) {
          html += `<div class="notes">${exercise.notes}</div>`;
        } else {
          html += '<div class="notes"></div>';
        }

        html += "</div>";
      });

      searchResultsContent.innerHTML = html;
      searchResults.style.display = "block";
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr + "T00:00:00");
      return date.toLocaleDateString("en-US", {
        month: "short",
        day: "numeric",
        year: "numeric",
      });
    }
  });
</script>
{% endblock %}
